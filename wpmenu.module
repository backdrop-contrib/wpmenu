<?php

/**
 * @file
 * WordPress wpmenu clone.
 */

/**
 * Implements hook_theme().
 */
function wpmenu_theme($existing, $type, $theme, $path) {
  $items['wpmenu_top'] = array(
    'render element' => 'element',
    'template' => 'wpmenu-top',
    'path' => drupal_get_path('module', 'wpmenu') . '/templates',
  );
  $items['wpmenu_left'] = array(
    'render element' => 'element',
    'template' => 'wpmenu-left',
    'path' => drupal_get_path('module', 'wpmenu') . '/templates',
  );

  return $items;
}

/**
 * Implements hook_preprocess_HOOK() for HTML document templates.
 */
function wpmenu_preprocess_html(&$variables) {
  $variables['classes_array'][] = 'wp-admin wp-core-ui no-js index-php auto-fold admin-bar branch-4-2 version-4-2-4 admin-color-fresh locale-en-us no-customize-support no-svg';
  $variables['rdf_namespaces'] = ' class="wp-toolbar"';

  $variables['page']['page_top'][] = array('foo' => array('#markup' => '<div id="wpwrap">' . theme('wpmenu_left') . '<div id="wpcontent" class="layout-container">' . theme('wpmenu_top') . $variables['page']['page_top']));
  $variables['page']['page_bottom'][] = array('foo' => array('#markup' => '</div></div>'));
}

/**
 * Prepares variables for administration toolbar templates.
 *
 * Default template: wpmenu-top.html.twig.
 *
 * @param array $variables
 *   An associative array containing:
 *   - element: An associative array containing the properties and children of
 *     the tray. Properties used: #children, #attributes and #bar.
 */
function template_preprocess_wpmenu_top(&$variables) {
  global $site_name,$base_path, $user;
  $current_path = current_path();
  $types = node_type_get_types();
  $content_types = array_keys($types);

  $variables['site_name'] = $site_name;
  $variables['base_path'] = $base_path;
  $variables['module_path'] = drupal_get_path('module', 'wpmenu');
  $variables['current_path'] = $current_path;
  $variables['content_types'] = $content_types;
  $variables['username'] = $user->name;
  $variables['uid'] = $user->uid;
  $variables['gravatar'] = 'https://www.gravatar.com/avatar/' . strtolower(trim(md5($user->mail)));
}

/**
 * Prepares variables for administration toolbar templates.
 *
 * Default template: wpmenu-left.html.twig.
 *
 * @param array $variables
 *   An associative array containing:
 *   - element: An associative array containing the properties and children of
 *     the tray. Properties used: #children, #attributes and #bar.
 */
function template_preprocess_wpmenu_left(&$variables) {
  global $base_path;
  $current_path = current_path();
  $module_path = drupal_get_path('module', 'wpmenu');
//  $config = Yaml::parse(file_get_contents($module_path . '/wpmenu-left.yml'));
//
  $variables['base_path'] = $base_path;
  $variables['current_path'] = $current_path;
//  $variables['menu'] = $config['menu'];

  $variables['menu'] = array(
    'menu' => array(
      'separator' => FALSE,
      'url' => 'admin',
      'text' => 'Dasboard',
      'icon' => 'dashboard',
      'children' => array(
          array(
            'url' => '/admin',
            'text' => 'Index'
          ),
          array(
            'url' => 'update.php',
            'text' => 'Update'
          )
        )
      ),
    array(
    'separator' => TRUE,
    'url' => 'admin/content',
    'text' => 'Content',
    'icon' => 'admin-page',
    'children' => array(
      array(
        'url' => '/admin/content/add',
        'text' => 'Add'
      )
    )
  )
    );
}

/**
 * Implements hook_js_alter().
 */
function wpmenu_js_alter(&$js) {
  $js = drupal_add_js('/sites/all/libraries/wordpress/wp-admin/js/common.min.js');
  $js = drupal_add_js('/sites/all/libraries/wordpress/wp-includes/js/admin-bar.min.js');
  $js = drupal_add_js('/sites/all/libraries/wordpress/wp-includes/js/utils.min.js');
}
/**
 * Implements hook_css_alter().
 */
function wpmenu_css_alter(&$css) {
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-includes/css/dashicons.min.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-includes/css/admin-bar.min.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-admin/css/wp-admin.min.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-includes/css/buttons.min.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-admin/css/common.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-admin/css/forms.css', array('type' => 'external', 'weight' => 0));
  $css = drupal_add_css('/sites/all/libraries/wordpress/wp-admin/css/admin-menu.css', array('type' => 'external', 'weight' => 0));
}
